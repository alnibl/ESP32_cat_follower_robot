# Конфигурация системы отслеживания кота
# Cat Follower Robot Configuration

import os
from dotenv import load_dotenv

# Загрузка переменных из .env файла
load_dotenv()

# ========== ПАРАМЕТРЫ ПОДКЛЮЧЕНИЯ ==========
# Connection Parameters

# RTSP URL вашей IP камеры (загружается из .env файла)
# Примеры форматов:
# - "rtsp://192.168.0.100:554/stream"
# - "rtsp://admin:password@192.168.0.100:554/stream"
# - "rtsp://192.168.0.100:8554/live/stream1"
CAMERA_URL = os.getenv("CAMERA_URL", "rtsp://192.168.0.100:554/stream")

# IP адрес ESP32 (из Serial Monitor при загрузке, загружается из .env файла)
ESP32_IP = os.getenv("ESP32_IP", "192.168.0.100")

# ========== ПАРАМЕТРЫ YOLO ==========
# YOLO Detection Parameters

# Модель YOLO11
# Варианты:
#   - yolo11n.pt (PyTorch, nano - базовая скорость)
#   - yolo11n_openvino_model (OpenVINO, оптимизирована для Intel CPU - быстрее в 5x!)
# Рекомендуется: yolo11n_openvino_model для Intel процессоров
YOLO_MODEL = "yolo11n_openvino_model"  # Ускорение 5.44x на i5-1235U!

# Минимальная уверенность детекции (0.0 - 1.0)
# Чем выше значение - тем меньше ложных срабатываний
# Понижено до 0.4 для лучшей детекции кота (было 0.5)
CONFIDENCE_THRESHOLD = 0.2

# Class ID для кота в COCO dataset
CAT_CLASS_ID = 15

# ========== ПАРАМЕТРЫ ВИДЕО ==========
# Video Parameters

# Разрешение кадра для обработки
FRAME_WIDTH = 640
FRAME_HEIGHT = 480

# Показывать ли окно с видео
SHOW_VIDEO = True

# Пропуск кадров для стабильности
# Обрабатывать каждый N-ый кадр (1 = все кадры, 2 = каждый второй, 3 = каждый третий)
# Для плавной работы рекомендуется 2-3 (уменьшает нагрузку, увеличивает стабильность)
FRAME_SKIP = 2  # Обрабатывать каждый 2-й кадр (~12 FPS вместо 24 FPS)

# ========== ПАРАМЕТРЫ УПРАВЛЕНИЯ ==========
# Control Parameters

# Зона центрирования (пиксели)
# Если кот в пределах +/- CENTER_THRESHOLD от центра кадра - считается что он в центре
CENTER_THRESHOLD = 80

# Пороги расстояния (высота bbox в пикселях)
# Если высота bbox кота меньше MIN_DISTANCE - кот далеко, едем вперёд
MIN_DISTANCE = 50

# Если высота bbox кота больше MAX_DISTANCE - кот слишком близко, отъезжаем
MAX_DISTANCE = 400

# ========== СКОРОСТИ МОТОРОВ ==========
# Motor Speeds (0-255)

# Скорость движения вперёд (быстро - когда кот далеко)
SPEED_FORWARD_FAST = 200

# Скорость движения вперёд (медленно - режим поиска)
SPEED_FORWARD_SLOW = 150

# Скорость поворота (быстро)
SPEED_TURN_FAST = 200

# Скорость поворота (медленно)
SPEED_TURN_SLOW = 150

# Скорость в режиме поиска (увеличена с 100 до 180 - моторы не запускались)
SPEED_SEARCH = 180

# Скорость отъезда назад
SPEED_BACKWARD = 200

# ========== КАЛИБРОВКА ==========
# Calibration

# Коэффициент компенсации ухода влево (0.0 - 1.0)
# Если робот уходит влево при движении вперёд:
#   - Увеличьте значение (например, 0.2)
# Если робот уходит вправо:
#   - Уменьшите значение (например, 0.1)
# Если едет прямо:
#   - Установите 0.0 (отключить компенсацию)
# ОТКЛЮЧЕНО для упрощения (0.0 = нет компенсации)
DRIFT_COMPENSATION = 0.0

# Частота применения компенсации (каждая N-ая команда forward)
# Например, 3 = каждая третья команда forward заменяется на right
DRIFT_CORRECTION_FREQUENCY = 3

# ========== ВРЕМЕННЫЕ ИНТЕРВАЛЫ ==========
# Timing Parameters

# Длительность команды поворота (миллисекунды)
TURN_DURATION = 500

# Длительность команды движения вперёд/назад (миллисекунды)
MOVE_DURATION = 500

# Минимальный интервал между отправкой команд (секунды)
# Увеличено чтобы ESP32 успевал выполнять команды
# ESP32 имеет таймеры на 500мс (forward/backward) и 500мс (left/right)
# Поэтому интервал должен быть >= 0.6 сек
COMMAND_INTERVAL = 0.7  # Отправлять команды каждые 700мс

# ========== РЕЖИМ ПОИСКА ==========
# Search Mode Parameters

# Интервал смены направления в режиме поиска (секунды)
SEARCH_CHANGE_INTERVAL = 3

# Варианты направления поиска: "left", "right", "random"
SEARCH_DIRECTION = "random"

# ========== ОТЛАДКА ==========
# Debug Parameters

# Выводить отладочную информацию в консоль
DEBUG = True

# Показывать FPS на видео
SHOW_FPS = True

# Показывать линии центрирования на видео
SHOW_CENTER_LINES = True

# Сохранять лог команд в файл
LOG_COMMANDS = False
LOG_FILE = "robot_commands.log"
