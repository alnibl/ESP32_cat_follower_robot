# Схема подключения ESP32-S3-DevKitC-1 N8R2 к моторам

## Важно знать о ESP32-S3

ESP32-S3 имеет некоторые ограничения по пинам:
- GPIO 0-18: Безопасны для использования
- GPIO 19, 20: USB D-, D+ (лучше не использовать если нужен USB)
- GPIO 26-32: Используются для Flash и PSRAM (НЕЛЬЗЯ использовать!)
- GPIO 33-48: Безопасны для использования

## Рекомендуемая схема подключения

### Подключение моторов к MX1508 драйверам

У вас 2 драйвера MX1508 или 1 двухканальный. Каждый канал управляет одним мотором.

#### Драйвер 1 (Левый мотор):
```
ESP32-S3 GPIO1  → MX1508 IN1 (Левый мотор вперед)
ESP32-S3 GPIO2  → MX1508 IN2 (Левый мотор назад)
Левый мотор +   → MX1508 MOTOR-A +
Левый мотор -   → MX1508 MOTOR-A -
```

#### Драйвер 2 (Правый мотор):
```
ESP32-S3 GPIO42 → MX1508 IN3 (Правый мотор вперед)
ESP32-S3 GPIO41 → MX1508 IN4 (Правый мотор назад)
Правый мотор +  → MX1508 MOTOR-B +
Правый мотор -  → MX1508 MOTOR-B -
```

### Питание

#### Вариант 1: От PowerBank (Рекомендуется для начала)
```
PowerBank 5V OUT → MX1508 VCC (питание логики драйвера)
PowerBank 5V OUT → MX1508 VM (питание моторов, до 10V max)
PowerBank 5V OUT → ESP32 VIN (или через USB-C)
PowerBank GND    → MX1508 GND
PowerBank GND    → ESP32 GND
```

#### Вариант 2: От батареи 18650 (2S = 7.4V)
```
2S Battery 7.4V  → MX1508 VM (питание моторов)
5V Buck Converter → MX1508 VCC (от батареи через понижающий преобразователь)
5V Buck Converter → ESP32 VIN
Common GND для всех устройств
```

### Подключение камеры

```
PowerBank 5V OUT → IP Camera DC 5V IN
PowerBank GND    → IP Camera GND
```

Камера подключается к WiFi роутеру беспроводно и не требует физического подключения к ESP32.

## Полная схема подключения

```
┌─────────────┐
│  PowerBank  │
│   5V/2A+    │
└──┬──┬──┬───┘
   │  │  │
   │  │  └─────────────────┐
   │  │                    │
   │  │  ┌─────────────────▼──────┐
   │  │  │   IP Camera (5V)       │
   │  │  │   WiFi Connection      │
   │  │  └────────────────────────┘
   │  │
   │  │  ┌──────────────────┐
   │  └─▶│  ESP32-S3        │
   │     │  VIN (5V)        │
   │     │                  │
   │     │  GPIO1  ───────┐ │
   │     │  GPIO2  ─────┐ │ │
   │     │  GPIO42 ───┐ │ │ │
   │     │  GPIO41 ─┐ │ │ │ │
   │     │  GND ────┼─┼─┼─┼─┼──┐
   │     └──────────┼─┼─┼─┼─┼──┼───┐
   │                │ │ │ │ │  │   │
   │     ┌──────────▼─▼─▼─▼─▼──▼─┐ │
   └────▶│  MX1508 Driver(s)      │ │
         │  VCC (5V) VIN VM       │ │
         │                        │ │
         │  IN1  IN2  IN3  IN4    │ │
         │   │    │    │    │     │ │
         │   ▼    ▼    ▼    ▼     │ │
         │ MOTOR-A    MOTOR-B     │ │
         │   │  │       │  │      │ │
         └───┼──┼───────┼──┼──────┘ │
             │  │       │  │        │
         ┌───▼──▼──┐ ┌──▼──▼───┐    │
         │ Левый   │ │ Правый  │    │
         │ мотор   │ │ мотор   │    │
         └─────────┘ └─────────┘    │
                                    │
         Common GND ◄───────────────┘
```

## Пошаговая инструкция по подключению

### Шаг 1: Подготовка
1. Отключите все от питания
2. Приготовьте провода (лучше разных цветов)
3. Приготовьте паяльник или клеммники

### Шаг 2: Подключение GND (ВАЖНО СДЕЛАТЬ ПЕРВЫМ!)
1. Соедините GND от ESP32, MX1508 драйверов и PowerBank вместе
2. Это общий провод (обычно черный или синий)

### Шаг 3: Подключение драйверов моторов к ESP32
1. Подключите GPIO1 к IN1 первого драйвера
2. Подключите GPIO2 к IN2 первого драйвера
3. Подключите GPIO42 к IN3 второго драйвера (или к IN3 на том же если двухканальный)
4. Подключите GPIO41 к IN4 второго драйвера

### Шаг 4: Подключение питания драйверов
1. MX1508 VCC к PowerBank 5V (питание логики)
2. MX1508 VM к PowerBank 5V (питание моторов, можно до 10V)

### Шаг 5: Подключение моторов к драйверам
1. Левый мотор к MOTOR-A на первом драйвере
2. Правый мотор к MOTOR-B на втором драйвере (или на том же)
3. Полярность не критична - если мотор крутится не в ту сторону, поменяйте провода местами

### Шаг 6: Питание ESP32
1. Подключите PowerBank к ESP32 через USB-C кабель
   ИЛИ
2. Подключите PowerBank 5V к пину VIN на ESP32 (и GND к GND)

### Шаг 7: Питание камеры
1. Подключите PowerBank 5V к разъему питания камеры (обычно micro-USB или DC jack)

## Проверка подключения

Перед включением проверьте:
- ✅ Все GND соединены вместе
- ✅ Нет коротких замыканий (5V не касается GND)
- ✅ Полярность питания правильная
- ✅ Сигнальные пины подключены к правильным GPIO
- ✅ PowerBank заряжен

## Тестирование

1. Подключите только ESP32 к USB компьютера (без моторов)
2. Загрузите тестовый код
3. Проверьте, что ESP32 подключается к WiFi
4. Отключите USB, подключите полную схему с PowerBank
5. Подключите USB обратно для мониторинга Serial
6. Проверьте управление моторами через веб-интерфейс

## Характеристики компонентов

### MX1508 Motor Driver
- Входное напряжение: 2-10V
- Ток на канал: до 2.5A
- PWM частота: до 100kHz
- Логические уровни: 2.5-12V

### ESP32-S3
- Рабочее напряжение: 3.3V (внутреннее)
- Входное напряжение VIN: 5V
- GPIO выходной ток: 40mA max на пин
- PWM: Все GPIO поддерживают

### Важные замечания
1. MX1508 может работать с логическими сигналами 3.3V от ESP32 (но лучше проверить даташит)
2. Если моторы потребляют много тока, PowerBank должен выдавать минимум 2A
3. Используйте короткие провода для сигналов (максимум 20-30см)
4. Для силовых проводов используйте более толстые провода (минимум 0.5мм²)
